<div *ngIf="showSpinner" class="whiteFilm"><i class="fa fa-spinner fa-spin fa-5x loader" aria-hidden="true"></i></div>
<div class="uk-section-default uk-section uk-section-small uk-padding-remove-bottom" style="min-height: 325px">
  <div class="uk-container uk-container-expand">
    <div class="tm-header-placeholder uk-margin-remove-adjacent" style="height: 84px;"></div>
    <div class="uk-grid-margin uk-grid uk-grid-stack" uk-grid="">
      <div class="uk-width-1-1@m uk-first-column">

        <h1 class="uk-h3 uk-heading-bullet uk-padding-small">
          Αίτημα {{requestId}}
          <span *ngIf="currentRequest" class="uk-text-small">[{{ reqTypes[currentRequest.type] }}]</span></h1>
        <!--<button class="uk-button uk-button-small" (click)="printRequest()">Εκτύπωση</button>-->

        <!-- TOP HELP CONTENT -->
        <help-content #topHelperContent [position]="'top'"
                      [ngClass]="topHelperContent.isPresent()?'uk-margin-medium-top uk-margin-medium-bottom':'clear-style'">
        </help-content>

        <div class="uk-container uk-container-expand uk-margin-medium-top uk-margin-medium-bottom">
          <div class="uk-grid">

            <!-- LEFT HELP CONTENT -->
            <aside-help-content #leftHelperContent [position]="'left'"
                                [ngClass]="leftHelperContent.isPresent()?'tm-sidebar uk-width-1-4@m uk-first-column':'clear-style'">
            </aside-help-content>

            <!-- MIDDLE -->
            <div class=" uk-width-expand@m">
              <div *ngIf="errorMessage" class="uk-alert uk-alert-danger">{{ errorMessage }}</div>
              <div *ngIf="successMessage" class="uk-alert uk-alert-success">{{ successMessage }}</div>
              <!--<div *ngIf="showSpinner" class="uk-inline uk-position-center uk-padding-large-top">-->
              <!--<div class="uk-overlay-default uk-position-cover"></div>-->
              <!--<div uk-spinner="ratio: 2" class="uk-overlay uk-dark"></div>-->
              <!--</div>-->
              <div id="printable-section"
                   *ngIf="!showSpinner &&
                          currentRequest &&
                          currentRequest.requester &&
                          currentRequest.project &&
                          currentRequest.stage1 &&
                          (canEdit === true || canEdit === false)">

                <!--1st stage-->
                <!--<span>{{ stagesMap[currentRequest.stage].title }}</span>-->
                <div *ngIf="willShowStage('1') !== 1" class="submittedRequest">
                  <div class="uk-margin-bottom uk-width-1-1 uk-grid">
                    <div class="uk-width-1-2@l">
                      <span class="uk-text-bold uk-margin-small-right">Πρόγραμμα: </span>
                      <span>{{ currentRequest.project.acronym }} ({{currentRequest.project.institute.name}})</span>
                    </div>
                    <div class="uk-width-1-2@l">
                      <span class="uk-text-bold uk-margin-small-right">Ημερομηνία υποβολής: </span>
                      <span>{{ currentRequest.stage1.requestDate | date : 'dd-MM-yyyy' }}</span>
                    </div>
                    <div class="uk-width-1-1@l">
                      <span class="uk-text-bold uk-margin-small-right">Από: </span>
                      <span>
                      {{ currentRequest.requester.firstname }} {{ currentRequest.requester.lastname }}
                       ({{ currentRequest.requesterPosition }})
                      </span>
                    </div>

                    <div *ngIf="(currentRequest.type !== 'trip') && (currentRequest.type !== 'contract')" class="uk-width-1-2@l">
                      <span class="uk-text-bold uk-margin-small-right">Προμηθευτής: </span>
                      <span>{{ currentRequest.stage1.supplier }} ({{ currentRequest.stage1.supplierSelectionMethod }})</span>
                    </div>
                    <div class="uk-width-1-2@l">
                      <span class="uk-text-bold uk-margin-small-right">Ποσό: </span>
                      <span>{{ currentRequest.stage1.amountInEuros | currency: 'EUR': 'symbol-narrow' }}</span>
                    </div>

                    <div class="uk-width-1-1@l">
                      <span class="uk-text-bold uk-margin-small-right">Θέμα:</span>
                      <span>{{ currentRequest.stage1.subject }}</span>
                    </div>

                    <div *ngIf="currentRequest.stage1.attachment">
                      <a class="uk-link uk-width-1-1@l uk-margin-small-top" (click)="linkToFile()">
                        Πατήστε εδώ για να κατεβάσετε τα σχετικά αρχεία
                      </a>
                    </div>

                  </div>
                </div>

                <!-- stage 1 form -->
                <div *ngIf="willShowStage('1') === 1">
                  <stage1-form [currentRequest]="currentRequest"
                               (emitFile)="getUploadedFile($event)"
                               (emitRequest)="getUpdatedRequest($event)"></stage1-form>
                </div>


                <! -- status report for users with ROLE_USER role -->
                <div *ngIf="!isSimpleUser &&
                            ( (currentRequest.stage2 && currentRequest.stage2.date) ||
                            ( (currentRequest.stage === '2') && (canEdit === true)) )">
                  <h4>Ανάληψη υποχρέωσης δαπάνης</h4>
                  <hr>
                </div>

                <!--end of 1st stage-->

                <div class="uk-child-width-expand uk-grid" uk-grid
                     *ngIf="( (willShowStage('2') > 1) || (willShowStage('3') > 1) || (willShowStage('4') > 1) )">

                  <stage2-component class="uk-card uk-card-body uk-card-basic-info uk-margin-left newStyle"
                                    *ngIf="willShowStage('2') > 1"
                                    [showStage]="willShowStage('2')"
                                    [currentStage]="currentRequest.stage2"
                                    [currentProject]="currentRequest.project"></stage2-component>

                  <stage3-component class="uk-card uk-card-body uk-card-basic-info uk-margin-left newStyle"
                                    *ngIf="willShowStage('3') > 1"
                                    [showStage]="willShowStage('3')"
                                    [currentStage]="currentRequest.stage3"
                                    [currentProject]="currentRequest.project"></stage3-component>

                  <stage4-component class="uk-card uk-card-body uk-card-basic-info uk-margin-left newStyle"
                                    *ngIf="willShowStage('4') > 1"
                                    [showStage]="willShowStage('4')"
                                    [currentStage]="currentRequest.stage4"
                                    [currentProject]="currentRequest.project"></stage4-component>

                </div>


                <div *ngIf="isSimpleUser && (currentRequest.stage !== '1')" class="uk-alert uk-alert-primary uk-text-center uk-margin-top">
                  Το αίτημά σας {{ stateNames[currentRequest.status] }}
                </div>


                <div class="uk-child-width-expand uk-grid" uk-grid
                     *ngIf="( (willShowStage('5a') > 1) || (willShowStage('5b') > 1) || (willShowStage('6') > 1) )">

                  <stage5a-component class="uk-card uk-card-body uk-card-basic-info uk-margin-left"
                                     *ngIf="willShowStage('5a') > 1"
                                     [showStage]="willShowStage('5a')"
                                     [currentStage]="currentRequest.stage5a"
                                     [currentProject]="currentRequest.project"></stage5a-component>

                  <stage5b-component class="uk-card uk-card-body uk-card-basic-info uk-margin-left"
                                     *ngIf="willShowStage('5b') > 1"
                                     [showStage]="willShowStage('5b')"
                                     [currentStage]="currentRequest.stage5b"
                                     [currentProject]="currentRequest.project"></stage5b-component>

                  <stage6-component class="uk-card uk-card-body uk-card-basic-info uk-margin-left"
                                    *ngIf="willShowStage('6') > 1"
                                    [showStage]="willShowStage('6')"
                                    [currentStage]="currentRequest.stage6"
                                    [currentProject]="currentRequest.project"></stage6-component>

                </div>


                <div class="uk-margin-top" *ngIf="!isSimpleUser &&
                                                  ((currentRequest.stage7 && currentRequest.stage7.date) ||
                                                  ( (currentRequest.stage === '7') && (canEdit === true)) )">
                  <h4>Εξόφληση Δαπάνης</h4>
                  <hr>
                </div>


                <div class="uk-child-width-expand uk-grid" uk-grid
                     *ngIf="( (willShowStage('7') > 1) || (willShowStage('8') > 1) || (willShowStage('9') > 1) )">

                  <stage7-component class="uk-card uk-card-body uk-card-basic-info uk-margin-left"
                                    *ngIf="willShowStage('7') > 1"
                                    [showStage]="willShowStage('7')"
                                    [currentStage]="currentRequest.stage7"
                                    [currentProject]="currentRequest.project"></stage7-component>

                  <stage8-component class="uk-card uk-card-body uk-card-basic-info uk-margin-left"
                                    *ngIf="willShowStage('8') > 1"
                                    [showStage]="willShowStage('8')"
                                    [currentStage]="currentRequest.stage8"
                                    [currentProject]="currentRequest.project"></stage8-component>

                  <stage9-component class="uk-card uk-card-body uk-card-basic-info uk-margin-left"
                                    *ngIf="willShowStage('9') > 1"
                                    [showStage]="willShowStage('9')"
                                    [currentStage]="currentRequest.stage9"
                                    [currentProject]="currentRequest.project"></stage9-component>
                </div>

                <div class="uk-child-width-expand uk-grid" uk-grid
                     *ngIf="( (willShowStage('10') > 1) || (willShowStage('11') > 1) )">
                  <stage10-component class="uk-card uk-card-body uk-card-basic-info uk-margin-left"
                                     *ngIf="willShowStage('10') > 1"
                                     [showStage]="willShowStage('10')"
                                     [currentStage]="currentRequest.stage10"
                                     [currentProject]="currentRequest.project"></stage10-component>

                  <stage11-component class="uk-card uk-card-body uk-card-basic-info uk-margin-left"
                                     *ngIf="willShowStage('11') > 1"
                                     [showStage]="willShowStage('11')"
                                     [currentStage]="currentRequest.stage11"
                                     [currentProject]="currentRequest.project"></stage11-component>
                </div>


                <div class="uk-child-width-expand uk-grid" uk-grid
                     *ngIf="( (willShowStage('12') > 1) || (willShowStage('13') > 1) )">
                  <stage12-component class="uk-card uk-card-body uk-card-basic-info uk-margin-left"
                                     *ngIf="willShowStage('12') > 1"
                                     [showStage]="willShowStage('12')"
                                     [currentStage]="currentRequest.stage12"
                                     [currentProject]="currentRequest.project"></stage12-component>

                  <stage13-component class="uk-card uk-card-body uk-card-basic-info uk-margin-left"
                                     *ngIf="willShowStage('13') > 1"
                                     [showStage]="willShowStage('13')"
                                     [currentStage]="currentRequest.stage13"
                                     [currentProject]="currentRequest.project"></stage13-component>
                </div>



                <div class="uk-margin-medium-top">
                  <!--<hr>-->

                  <stage2-component *ngIf="willShowStage('2') === 1" [showStage]="1"
                                    [currentStage]="currentRequest.stage2" [currentProject]="currentRequest.project"
                                    (emitGoBack)="getRequestToGoBack($event)" (emitStage)="getSubmittedStage($event)"
                                    (emitFile)="getUploadedFile($event)"></stage2-component>

                  <stage3-component *ngIf="willShowStage('3') === 1" [showStage]="1"
                                    [currentStage]="currentRequest.stage3" [currentProject]="currentRequest.project"
                                    (emitGoBack)="getRequestToGoBack($event)" (emitStage)="getSubmittedStage($event)"
                                    (emitFile)="getUploadedFile($event)"></stage3-component>

                  <stage4-component *ngIf="willShowStage('4') === 1" [showStage]="1"
                                    [currentStage]="currentRequest.stage4" [currentProject]="currentRequest.project"
                                    (emitGoBack)="getRequestToGoBack($event)" (emitStage)="getSubmittedStage($event)"
                                    (emitFile)="getUploadedFile($event)"></stage4-component>

                  <stage5a-component *ngIf="willShowStage('5a') === 1" [showStage]="1"
                                     [currentStage]="currentRequest.stage5a" [currentProject]="currentRequest.project"
                                     (emitGoBack)="getRequestToGoBack($event)" (emitStage)="getSubmittedStage($event)"
                                     (emitFile)="getUploadedFile($event)"></stage5a-component>

                  <stage5b-component *ngIf="willShowStage('5b') === 1" [showStage]="1"
                                     [currentStage]="currentRequest.stage5b" [currentProject]="currentRequest.project"
                                     (emitGoBack)="getRequestToGoBack($event)" (emitStage)="getSubmittedStage($event)"
                                     [oldSupplierAndAmount]="sendInfoToStage5b"
                                     (newValues)="getNewSupplierAndAmount($event)"
                                     (emitFile)="getUploadedFile($event)"></stage5b-component>

                  <stage6-component *ngIf="willShowStage('6') === 1" [showStage]="1"
                                    [currentStage]="currentRequest.stage6" [currentProject]="currentRequest.project"
                                    (emitGoBack)="getRequestToGoBack($event)" (emitStage)="getSubmittedStage($event)"
                                    (emitFile)="getUploadedFile($event)"></stage6-component>

                  <stage7-component *ngIf="willShowStage('7') === 1" [showStage]="1"
                                    [currentStage]="currentRequest.stage7" [currentProject]="currentRequest.project"
                                    (emitGoBack)="getRequestToGoBack($event)" (emitStage)="getSubmittedStage($event)"
                                    (emitFile)="getUploadedFile($event)"></stage7-component>

                  <stage8-component *ngIf="willShowStage('8') === 1" [showStage]="1"
                                    [currentStage]="currentRequest.stage8" [currentProject]="currentRequest.project"
                                    (emitGoBack)="getRequestToGoBack($event)" (emitStage)="getSubmittedStage($event)"
                                    (emitFile)="getUploadedFile($event)"></stage8-component>

                  <stage9-component *ngIf="willShowStage('9') === 1" [showStage]="1"
                                    [currentStage]="currentRequest.stage9" [currentProject]="currentRequest.project"
                                    (emitGoBack)="getRequestToGoBack($event)" (emitStage)="getSubmittedStage($event)"
                                    (emitFile)="getUploadedFile($event)"></stage9-component>

                  <stage10-component *ngIf="willShowStage('10') === 1" [showStage]="1"
                                     [currentStage]="currentRequest.stage10" [currentProject]="currentRequest.project"
                                     (emitGoBack)="getRequestToGoBack($event)" (emitStage)="getSubmittedStage($event)"
                                     (emitFile)="getUploadedFile($event)"></stage10-component>

                  <stage11-component *ngIf="willShowStage('11') === 1" [showStage]="1"
                                     [currentStage]="currentRequest.stage11" [currentProject]="currentRequest.project"
                                     (emitGoBack)="getRequestToGoBack($event)" (emitStage)="getSubmittedStage($event)"
                                     (emitFile)="getUploadedFile($event)"></stage11-component>

                  <stage12-component *ngIf="willShowStage('12') === 1" [showStage]="1"
                                     [currentStage]="currentRequest.stage12" [currentProject]="currentRequest.project"
                                     (emitGoBack)="getRequestToGoBack($event)" (emitStage)="getSubmittedStage($event)"
                                     (emitFile)="getUploadedFile($event)"></stage12-component>

                  <stage13-component *ngIf="willShowStage('13') === 1" [showStage]="1"
                                     [currentStage]="currentRequest.stage13" [currentProject]="currentRequest.project"
                                     (emitGoBack)="getRequestToGoBack($event)" (emitStage)="getSubmittedStage($event)"
                                     (emitFile)="getUploadedFile($event)"></stage13-component>
                </div>


              </div>
            </div>

            <!-- RIGHT HELP CONTENT -->
            <aside-help-content #rightHelperContent [position]="'right'"
                                [ngClass]="rightHelperContent.isPresent()?'tm-sidebar uk-width-1-4@m uk-first-column':'clear-style'">
            </aside-help-content>

          </div>
        </div>


        <!-- BOTTOM HELP CONTENT -->
        <help-content #bottomHelperContent [position]="'bottom'"
                      [ngClass]="bottomHelperContent.isPresent()?'uk-margin-medium-top uk-margin-medium-bottom':'clear-style'">
        </help-content>


      </div>
    </div>
  </div>
</div>
